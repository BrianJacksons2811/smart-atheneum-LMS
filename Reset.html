<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reset Password</title>
  <link rel="stylesheet" href="forgot-pass.css">
</head>
<body>
  <div class="forgot-container">
    <h2>Set a new password</h2>
    <div class="input-box">
      <input type="password" id="pw" placeholder="New password" required>
    </div>
    <div class="input-box">
      <input type="password" id="pw2" placeholder="Confirm new password" required>
    </div>
    <button id="btn">Reset Password</button>
    <div id="message" class="message"></div>
    <a class="back-btn" href="login.html">&#8592 Back to Sign-In</a>
  </div>

<script>
const qs = (k) => new URLSearchParams(location.search).get(k);

document.getElementById('btn').addEventListener('click', async () => {
  const pw = document.getElementById('pw').value.trim();
  const pw2 = document.getElementById('pw2').value.trim();
  const msg = document.getElementById('message');

  if (pw.length < 8) { msg.textContent = 'Password must be at least 8 characters.'; msg.className='message error'; return; }
  if (pw !== pw2)  { msg.textContent = 'Passwords do not match.'; msg.className='message error'; return; }

  try {
    const res = await fetch('/api/auth/reset-password', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ userId: qs('id'), token: qs('token'), newPassword: pw })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Reset failed');

    msg.textContent = 'Password changed. You can now log in.';
    msg.className = 'message success';
  } catch (e) {
    msg.textContent = e.message || 'Something went wrong.';
    msg.className = 'message error';
  }
});
</script>
</body>
</html>
